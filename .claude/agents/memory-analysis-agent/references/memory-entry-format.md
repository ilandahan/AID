# Memory Entry Format

Specification for Claude Memory entries generated by the analysis agent.

---

## Entry Structure

```
AID:{ROLE}:{PHASE}:{TYPE} {insight}
```

### Components

| Component | Values | Description |
|-----------|--------|-------------|
| `ROLE` | PM, DEV, QA, LEAD, ALL | Target role |
| `PHASE` | DISC, PRD, SPEC, BRK, DEV, QA, ALL | Target phase |
| `TYPE` | DO, DONT, ASK, CHECK | Action type |
| `insight` | Free text | The actual guidance |

---

## Role Codes

| Code | Full Name | Use When |
|------|-----------|----------|
| `PM` | Product Manager | Requirements, scope, stakeholders |
| `DEV` | Developer | Implementation, code, testing |
| `QA` | QA Engineer | Testing, validation, quality |
| `LEAD` | Tech Lead | Architecture, reviews, guidance |
| `ALL` | All Roles | Universal patterns |

---

## Phase Codes

| Code | Phase | Number |
|------|-------|--------|
| `DISC` | Discovery | 0 |
| `PRD` | PRD | 1 |
| `SPEC` | Tech Spec | 2 |
| `BRK` | Breakdown | 3 |
| `DEV` | Development | 4 |
| `QA` | QA & Ship | 5 |
| `ALL` | All Phases | - |

---

## Type Codes

| Code | Meaning | Example Verbs |
|------|---------|---------------|
| `DO` | Action to take | Write, Create, Include, Add |
| `DONT` | Action to avoid | Never, Avoid, Don't skip |
| `ASK` | Question to ask | Ask, Verify, Confirm |
| `CHECK` | Validation step | Ensure, Validate, Review |

---

## Constraints

### Length
- **Maximum**: 200 characters total
- **Recommended**: 100-150 characters
- **Minimum**: 50 characters (anything less is too vague)

### Content Rules

**Must**:
- Start with an action verb
- Be immediately actionable
- Apply across projects
- Be specific enough to follow

**Must Not**:
- Reference specific projects
- Include code
- Mention company names
- Be vague ("do things well")

---

## Quality Examples

### Excellent (Score: 0.9+)

```
AID:PM:DISC:ASK "Who else touches this data?" to find hidden stakeholders
AID:DEV:DEV:DO Write failing test before implementation (TDD red-green-refactor)
AID:QA:QA:DONT Never weaken test assertions to make tests pass
AID:LEAD:SPEC:CHECK Verify API contracts match data model before approval
AID:ALL:ALL:CHECK Confirm scope hasn't changed since last phase gate
```

### Good (Score: 0.7-0.9)

```
AID:PM:PRD:DO Include acceptance criteria for every user story
AID:DEV:SPEC:ASK "What happens if this service is unavailable?"
AID:QA:DEV:DO Test edge cases, not just happy path
```

### Poor (Don't Generate)

```
AID:PM:DISC:DO Remember stakeholders        # Too vague
AID:DEV:DEV:DO Write good code              # Not actionable
AID:ALL:ALL:DO Be careful                   # Meaningless
AID:PM:PRD:DO Include the payment feature   # Project-specific
```

---

## Promotion Criteria

An insight should be promoted to Claude Memory when:

| Criterion | Threshold |
|-----------|-----------|
| Occurrences | ≥ 5 sessions |
| Average rating when applied | ≥ 4.0 |
| Average revisions when applied | ≤ 2.0 |
| Confidence score | ≥ 0.75 |

---

## Deduplication

Before adding new entry, check existing memory for:
- Same role + phase + type combination
- Similar wording (>80% overlap)
- Contradicting guidance

If duplicate found:
- If same guidance: Skip
- If stronger evidence: Update existing
- If contradicting: Flag for review
