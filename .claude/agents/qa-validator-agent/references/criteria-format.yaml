# QA Criteria File Format
#
# This file documents the expected format for .aid/qa/{task-id}.yaml files
# that the QA Validator sub-agent reads to perform reviews.

# ─────────────────────────────────────────────────────────────
# TEMPLATE
# ─────────────────────────────────────────────────────────────

task_id: "{{JIRA-KEY like AUTH-123}}"

business_context: |
  Brief description of WHY this task matters to users.
  The QA agent uses this to understand the purpose but NOT
  to judge implementation approach.

criteria:
  # ─────────────────────────────────────────────────────────
  # must_achieve: Things the code MUST do
  # QA agent verifies these are clearly satisfied
  # ─────────────────────────────────────────────────────────
  must_achieve:
    - "Criterion 1 - clear, testable statement"
    - "Criterion 2 - observable behavior"
    - "Criterion 3 - specific outcome"

  # ─────────────────────────────────────────────────────────
  # must_not: Things the code MUST NOT do
  # QA agent verifies these are NOT present
  # ─────────────────────────────────────────────────────────
  must_not:
    - "Must NOT do X"
    - "Must NOT include Y"

  # ─────────────────────────────────────────────────────────
  # not_included: Scope boundaries - what's explicitly OUT
  # QA agent verifies this work was NOT done (deferred to another task)
  # ─────────────────────────────────────────────────────────
  not_included:
    - "Feature X (TASK-456)"
    - "Enhancement Y (TASK-789)"

  # ─────────────────────────────────────────────────────────
  # best_practices: Standards the code SHOULD meet
  # QA agent verifies these are followed
  # ─────────────────────────────────────────────────────────
  best_practices:
    - "Unit tests exist"
    - "Error handling present"
    - "Follows project conventions"

# ─────────────────────────────────────────────────────────────
# files_to_review: ONLY these files are checked
# QA agent MUST NOT access any other files
# ─────────────────────────────────────────────────────────────
files_to_review:
  - src/path/to/component.tsx
  - src/path/to/component.test.tsx

# ─────────────────────────────────────────────────────────────
# test_quality: REQUIRED for tasks involving test code
# Validates test code meets quality standards
# ─────────────────────────────────────────────────────────────
test_quality:
  organization:
    - "Tests in correct directory (unit/integration/e2e)?"
    - "File naming follows convention (*.test.ts, *.integration.test.ts)?"
    - "Test names describe behavior and condition?"

  security:
    - "No hardcoded passwords in test code?"
    - "No real API keys or tokens?"
    - "No credentials in README examples?"
    - "Sensitive data uses env vars or factories?"

  independence:
    - "No let variables at describe level without beforeEach?"
    - "No beforeAll for mutable shared state?"
    - "Cleanup present in afterEach?"
    - "Tests verified with --randomize flag?"

  assertions:
    - "Every test has at least one assertion?"
    - "Assertions check specific values, not just existence?"
    - "Error paths have explicit assertions?"
    - "Tests fail when code is broken (mutation test)?"

  regression:
    - "All existing tests still pass?"
    - "No tests skipped or marked .todo without justification?"

# ─────────────────────────────────────────────────────────────
# EXAMPLE: Complete criteria file
# ─────────────────────────────────────────────────────────────

---
# Example for AUTH-123: Email Validation on Login

task_id: AUTH-123

business_context: |
  Users need immediate feedback when they enter an invalid email format
  in the login form. This prevents frustration from submitting invalid data.

criteria:
  must_achieve:
    - "Email format is validated using regex before submission"
    - "Error message 'Invalid email format' displays below the input"
    - "Submit button is disabled while email is invalid"
    - "Validation triggers on blur, not on every keystroke"

  must_not:
    - "Must NOT log email address to console (PII)"
    - "Must NOT call login API until validation passes"
    - "Must NOT show error message before user has finished typing"

  not_included:
    - "Password strength validation (AUTH-124)"
    - "Remember me functionality (AUTH-125)"
    - "OAuth login buttons (AUTH-130)"

  best_practices:
    - "Unit tests cover valid and invalid email scenarios"
    - "Accessibility: error message linked with aria-describedby"
    - "Error state uses project's standard error styling"

files_to_review:
  - src/components/auth/LoginForm.tsx
  - src/components/auth/LoginForm.test.tsx
  - src/utils/validation.ts
